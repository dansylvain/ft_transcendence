{% load static %}
<div class="container-fluid">
  <!-- Page Heading -->
  <h1 data-translate="SETUP 2FA" class="h3 mb-2 text-gray-800">
    Set Up Two-Factor Authentication (2FA) for <strong>{{ username }}</strong>
  </h1>
  <p class="mb-4">
    Two-factor authentication adds an extra layer of security to your account by
    requiring more than just a password to sign in.
  </p>

  <div class="row justify-content-center">
    <!-- QR CODE COLUMN -->
    <div class="col-lg-6 mb-4">
      <div class="card shadow mb-4 h-100">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">
            Step 1: Scan QR Code
          </h6>
        </div>
        <div class="card-body text-center">
          <p>
            Scan the QR code with your authenticator app (like Google
            Authenticator, Authy, or Microsoft Authenticator)
          </p>
          {% if qr_code %}
          <img
            src="{{ qr_code }}"
            alt="QR Code"
            class="img-fluid"
            style="max-width: 250px"
          />
          {% else %}
          <div class="alert alert-danger">Error generating QR code</div>
          {% endif %}
          <p class="mt-3 text-xs">Or manually enter this key in your app:</p>
          <p class="mt-3 text-xs" id="secret_key">
            <strong>{{ secret }}</strong>
          </p>
        </div>
      </div>
    </div>

    <!-- VERIFY CODE FORM COLUMN -->
    <div class="col-lg-6 mb-4">
      <div class="card shadow mb-4 h-100">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Step 2: Verify Code</h6>
        </div>
        <div class="card-body">
          <form
            hx-post="/account/security/verify-2fa/"
            hx-target="#main_div"
            hx-headers='{"HX-Request": "true", "X-CSRFToken": "{{ csrf_token }}"}'
          >
            {% csrf_token %}
            <div class="form-group">
              <label>Enter the code generated by your authenticator app:</label>
              <input
                id="otp_input"
                type="number"
                name="token"
                maxlength="6"
                class="form-control form-control-user"
                placeholder="Enter 6-digit code"
                required
              />
            </div>
            <div class="form-group mt-4">
              <button
                type="submit"
                class="btn btn-primary btn-rounded btn-block"
                id="otp_verify"
              >
                Verify and Activate
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- CANCEL BUTTON -->
  <div class="row justify-content-center">
    <div class="col-lg-6 mb-4">
      <a
        href="/account/security/"
        class="btn btn-danger-custom btn-rounded btn-block mt-2"
        hx-get="/account/security/"
        hx-target="#main_div"
        hx-headers='{"HX-Request": "true"}'
      >
        Cancel
      </a>
    </div>
  </div>
</div>

<style>
  /* Green Button Styles for Rounded Button */
  .btn-rounded {
    border-radius: 50px; /* Makes the button rounded */
    padding: 0.75rem 1.5rem; /* Slightly more padding for a better look */
    font-size: 1rem; /* Keep the font size moderate */
    text-align: center;
    border-width: 2px;
    background-color: transparent; /* Transparent background by default */
    border-color: #28a745; /* Green border color */
    color: #28a745; /* Green text color */
    transition: background-color 0.3s, color 0.3s, border-color 0.3s;
  }

  /* Hover effect for the rounded button (green on hover) */
  .btn-rounded:hover {
    background-color: #28a745; /* Green background on hover */
    color: white; /* White text on hover */
    border-color: #28a745; /* Green border on hover */
    text-decoration: none; /* Remove underline on hover */
  }

  /* Active state when clicked */
  .btn-rounded:focus {
    background-color: #28a745;
    color: white;
    border-color: #28a745;
  }

  /* Red when disabled */
  .btn-danger-custom {
    border-color: #dc3545;
    color: #dc3545;
    background-color: transparent; /* Transparent inside the button */
  }

  .btn-danger-custom.active,
  .btn-danger-custom:focus {
    background-color: #dc3545 !important;
    color: white;
    border-color: #dc3545 !important;
  }

  /* Hover effects for the Cancel button */
  .btn-danger-custom:hover {
    background-color: #dc3545; /* Red background on hover */
    color: white; /* White text on hover */
    border-color: #dc3545; /* Red border on hover */
  }
</style>

<script src="https://unpkg.com/htmx.org@1.9.6/dist/htmx.min.js"></script>
