{% load static %}
<script src="{% static 'static_files/translations.js' %}"></script>
<script src="https://unpkg.com/htmx.org@1.9.6"></script>
<script src="{% static 'static_files/vendor/chart.js/Chart.js' %}"></script>
<script src="{% static 'static_files/js/demo/chart-area-demo.js' %}"></script>
<script src="{% static 'static_files/js/demo/chart-pie-demo.js' %}"></script>
<script>

    document.addEventListener("DOMContentLoaded", function () {
        document.body.addEventListener('htmx:afterSettle', function() {
                console.log("addEventListener('htmx:afterSwap')");
            document.querySelectorAll("script").forEach(oldScript => {
                const newScript = document.createElement("script");
                newScript.textContent = oldScript.textContent;
                Array.from(oldScript.attributes).forEach(attr => {
                    newScript.setAttribute(attr.name, attr.value);
                });
                oldScript.replaceWith(newScript);
            });
        });
    });
    
    window.addEventListener("beforeunload", () => {
        console.log("URL sauvegard√©e avec history.state et sessionStorage");
        
        let currentURL = window.location.href;

        // Sauvegarde dans history.state
        history.replaceState({ lastVisitedPage: currentURL }, "");

        // Sauvegarde dans sessionStorage
        sessionStorage.setItem("lastVisitedPage", currentURL);
    });
</script>