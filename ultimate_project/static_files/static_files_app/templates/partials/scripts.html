{% load static %}
<script src="https://kit.fontawesome.com/3dd39fb56b.js" crossorigin="anonymous"></script>
<script src="{% static 'static_files/translations.js' %}"></script>
<script src="https://unpkg.com/htmx.org@1.9.6"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
<script src="{% static 'static_files/vendor/jquery/jquery.min.js' %}"></script>
<script src="{% static 'static_files/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'static_files/vendor/jquery-easing/jquery.easing.min.js' %}"></script>
<script src="{% static 'static_files/js/sb-admin-2.min.js' %}"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.body.addEventListener('htmx:afterSettle', function() {
            toggleNavbarLogo()
            console.log("addEventListener('htmx:afterSwap'");
            document.querySelectorAll("script").forEach(oldScript => {
                const newScript = document.createElement("script");
                newScript.textContent = oldScript.textContent;
                Array.from(oldScript.attributes).forEach(attr => {
                    newScript.setAttribute(attr.name, attr.value);
                });
                oldScript.replaceWith(newScript);
            });
        });
    });
    window.addEventListener("beforeunload", () => {
        console.log("URL sauvegard√©e avec history.state et sessionStorage");
        
        let currentURL = window.location.href;

        // Sauvegarde dans history.state
        history.replaceState({ lastVisitedPage: currentURL }, "");

        // Sauvegarde dans sessionStorage
        sessionStorage.setItem("lastVisitedPage", currentURL);
    });
    

    // üîπ 1Ô∏è‚É£ Au chargement initial
    document.addEventListener("DOMContentLoaded", toggleNavbarLogo);

    // üîπ 2Ô∏è‚É£ √Ä chaque mise √† jour HTMX (√©vite le retard du `htmx:afterSettle`)
    // document.addEventListener("htmx:afterSwap", toggleNavbarLogo);

    // üîπ 3Ô∏è‚É£ Lorsqu'on navigue avec les boutons "Retour" / "Avancer"
    window.addEventListener("popstate", toggleNavbarLogo);

    function toggleSidebar(show) {
        console.log("toggleSidebar called");
        const sidebar = document.querySelector('#accordionSidebar');
        if (!sidebar)
            return;
        if (show) {
            sidebar.classList.remove('d-none');
        } else {
            sidebar.classList.add('d-none');
        }
    }

    function toggleNavbarLogo() {
    console.log("toggleNavbarLogo called");
    
    const isHomePage = document.querySelector('#home-page') !== null;  // V√©rifie si on est sur la page d'accueil
    const homelogo = document.querySelector('#homelogo');

    if (!homelogo) {
        return;
    }

    if (isHomePage) {
        console.log("adding logo");
        homelogo.classList.remove('d-none');
    } else {
        console.log("removing logo");
        homelogo.classList.add('d-none');
    }
}
</script>