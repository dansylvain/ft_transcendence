{% load static %}
<html>

    {% include "partials/head.html" %}
    <body   id="page-top" 
            hx-boost="true" 
            @popstate.window="navigate(window.location.pathname, false)
            bg-gradient-primary">
    
        <!-- display single pages conditions -->
         
        {% if page_name == "register.html" or page_name == "forgot-password.html" %}
            {{ page|safe }}
        {% elif page_name == "login.html" or page_name == "two-factor-auth.html" %}
            {{ page|safe }} 
        {% elif page_name == "error.html" %}
            {{ page|safe }}
        {% else %}

        <div id="wrapper">  <!-- template suff - DO NOT TOUCH -->


            <div id="content-wrapper" class="d-flex flex-column"> <!-- template suff -->
                
                <div id="content">  <!-- template suff - DO NOT TOUCH -->
                    
                    {% include "partials/navbar.html" %}
                    
                    <div id="main_div">

                        <!-- partials display conditions ... trust me :) -->

                        {% if page %}
                            {% if page|slice:"-5:" == ".html" %}
                                {% include page %}
                        {% else %}
                            {{ page|safe }}
                        {% endif %}
                        {% else %}
                        {% include "partials/home.html" %}
                        {% endif %}
                        
                        <!-- sidebar js stops working if this css is not HERE -->
                        <script src="{% static 'static_files/js/sb-admin-2.min.js' %}"></script>
                    </div> <!-- template suff - DO NOT TOUCH -->
                
                    {% include "partials/footer.html" %}
                    {% endif %}
                
                </div> <!-- template suff - DO NOT TOUCH -->
    
                <!-- include scripts at the end! -->
                
            </div>
        </div>
        <div id="modal-container"></div> 
        <script>
            // Check if the target element of the swap exists in the current document
            document.addEventListener("htmx:beforeSwap", function (evt) {
            let responseText = evt.detail.xhr.responseText.trim();
            if (responseText.startsWith("<!DOCTYPE html") || responseText.startsWith("<html")
            || responseText.startsWith("<div")) {
                console.warn("ðŸš¨ Full-page response detected, preventing HTMX swap.");
                evt.detail.shouldSwap = false; // Prevent HTMX from replacing content
                window.location.href = evt.detail.pathInfo.requestPath; // Redirect to the full page
                }
            });

            document.body.addEventListener('htmx:afterSwap', function(event) {
              if (event.target.id === 'modal-container') {
                console.log("HTMX swapped in modal."); // Debugging log
          
                let modalElement = document.getElementById('logoutModal');
                if (modalElement) {
                  let modalInstance = new bootstrap.Modal(modalElement);
                  modalInstance.show();
                  console.log("Modal is now visible."); // Debugging log
                } else {
                  console.error("Modal element not found!");
                }
              }
            });
          </script>                                
    </body>
</html>

